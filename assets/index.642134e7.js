var R=Object.defineProperty;var T=(i,e,t)=>e in i?R(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var h=(i,e,t)=>(T(i,typeof e!="symbol"?e+"":e,t),t);const U=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}};U();class d{constructor(e,t,n){h(this,"x",0);h(this,"y",0);h(this,"z",0);this.x=e!=null?e:0,this.y=t!=null?t:0,this.z=n!=null?n:0}add({x:e,y:t,z:n}){const s=new d(this.x,this.y,this.z);return s.x+=e,s.y+=t,s.z+=n,s}multiply(e){const t=new d(this.x,this.y,this.z);return t.x*=e,t.y*=e,t.z*=e,t}divide(e){const t=new d(this.x,this.y,this.z);return t.x/=e,t.y/=e,t.z/=e,t}}class f{constructor(e){h(this,"vertices");this.vertices=e}add(e){return new f(this.vertices.map(t=>t.add(e)))}subtract(e){return new f(this.vertices.map(t=>t.subtract(e)))}}class r{constructor(e,t,n){h(this,"x",0);h(this,"y",0);h(this,"z",0);this.x=e!=null?e:0,this.y=t!=null?t:0,this.z=n!=null?n:0}static getMidpoint(e,t){return new r((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}add(e){const t=new r(this.x,this.y,this.z);return t.x+=e.x,t.y+=e.y,t.z+=e.z,t}subtract(e){const t=new r(this.x,this.y,this.z);return t.x-=e.x,t.y-=e.y,t.z-=e.z,t}}class c{static rotateX(e,t){if(e instanceof f){const n=e.vertices.map(s=>c.rotateX(s,t));return new f(n)}else{const n=e.x,s=e.y*Math.cos(t)-e.z*Math.sin(t),o=e.y*Math.sin(t)+e.z*Math.cos(t);if(e instanceof r)return new r(n,s,o);if(e instanceof d)return new d(n,s,o)}}static rotateY(e,t){if(e instanceof f){const n=e.vertices.map(s=>c.rotateY(s,t));return new f(n)}else{const n=e.x*Math.cos(t)+e.z*Math.sin(t),s=e.y,o=-e.x*Math.sin(t)+e.z*Math.cos(t);if(e instanceof r)return new r(n,s,o);if(e instanceof d)return new d(n,s,o)}}}const O=new d(500,0,0),V=new d(0,500,0),W=new d(0,0,500),v=100,D=1e3,Z=1500,u=[new f([new r(100,100,1e3),new r(300,100,1e3),new r(300,300,1e3),new r(100,300,1e3)])];let x=0,P=0,z=window.innerWidth,g=window.innerHeight;function y(i){return i instanceof r?i.z>=0&&Math.abs(i.x)<=z+2*i.z&&Math.abs(i.y)<=g+2*i.z:i.vertices.every(e=>y(e))}const w=document.querySelector("#canvas");window.lockCursor=()=>{w.requestPointerLock()};document.addEventListener("pointerlockchange",()=>{console.log("wat"),E=document.pointerLockElement===w,E?document.querySelector("#pointerLockButton").style.display="none":document.querySelector("#pointerLockButton").style.display="block"});function N(){z=window.innerWidth,g=window.innerHeight,w.width=z,w.height=g}window.addEventListener("resize",N);N();const a=w.getContext("2d");a.lineWidth=4;a.fillStyle="white";a.fillRect(w.width,w.height,1,1);for(let i=-1e3;i<1e3;i+=200)u.push(new f([new r(i,1e3,-1e4),new r(i+50,1e3,-1e4),new r(i+50,1e3,1e4),new r(i,1e3,1e4)]));let k=!1,Y=!1,A=!1,K=!1,X=!1,I=!1,q=!1,E=!1,M=0,b=0;window.addEventListener("mousedown",()=>{q=!0});window.addEventListener("mouseup",()=>{q=!1});window.addEventListener("mousemove",i=>{!E&&!q||(M=i.movementX,b=i.movementY)});const _=new Set(["a","left"]),C=new Set(["d","e","right"]),F=new Set(["w","comma","up"]),H=new Set(["s","o","down"]);window.addEventListener("keydown",i=>{const{key:e}=i;_.has(e)?k=!0:C.has(e)?Y=!0:F.has(e)?A=!0:H.has(e)?K=!0:["shift"].includes(e)?X=!0:["space"].includes(e)&&(I=!0)});window.addEventListener("keyup",i=>{const{key:e}=i;_.has(e)&&(k=!1),C.has(e)&&(Y=!1),F.has(e)&&(A=!1),H.has(e)?K=!1:["shift"].includes(e)?X=!1:["space"].includes(e)&&(I=!1)});function j(){for(const[e,t]of u.entries())k&&(u[e]=t.add(c.rotateY(O.divide(v),-x))),Y&&(u[e]=t.subtract(c.rotateY(O.divide(v),-x))),A&&(u[e]=t.subtract(c.rotateX(c.rotateY(W.divide(v),-x),P))),K&&(u[e]=t.add(c.rotateX(c.rotateY(W.divide(v),-x),P))),I&&(u[e]=t.add(V.divide(v))),X&&(u[e]=t.add(V.divide(v)));x+=-M/D,P+=b/Z;const i=u.map(e=>(e=c.rotateY(e,x),e=c.rotateX(e,P),e));for(const[e,t]of i.entries())if(!y(t)){const n=new f([]),s=t.vertices.length;for(const[o,l]of t.vertices.entries()){const S=t.vertices[(o+1)%s];if(y(l)&&n.vertices.push(l),y(l)^y(S)){let m,L;for(y(l)?[m,L]=[l,S]:[m,L]=[S,l];;){const p=r.getMidpoint(m,L);if(p.equals(m)||p.equals(L))break;y(p)?m=p:L=p}const B=m;n.vertices.push(B)}}i[e]=n}for(const[e,t]of i.entries())for(const[n,s]of t.vertices.entries());a.clearRect(0,0,w.width,w.height);for(const e of i){if(e.vertices.length===0)continue;const t=e.vertices.map(n=>{const s=new r;return s.x=n.x*z/(z+2*n.z),s.y=n.y*g/(g+2*n.z),s.x+=z/2,s.y+=g/2,s});a.beginPath(),a.moveTo(t[0].x,t[0].y);for(const n of t.slice(1))a.lineTo(n.x,n.y);a.closePath(),a.fillStyle="black",a.fill()}M=0,b=0,requestAnimationFrame(j)}j();
