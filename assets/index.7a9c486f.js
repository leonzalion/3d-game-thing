var U=Object.defineProperty;var j=(i,e,t)=>e in i?U(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var w=(i,e,t)=>(j(i,typeof e!="symbol"?e+"":e,t),t);const B=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}};B();class l{constructor(e,t,n){w(this,"x",0);w(this,"y",0);w(this,"z",0);this.x=e!=null?e:0,this.y=t!=null?t:0,this.z=n!=null?n:0}add({x:e,y:t,z:n}){const s=new l(this.x,this.y,this.z);return s.x+=e,s.y+=t,s.z+=n,s}multiply(e){const t=new l(this.x,this.y,this.z);return t.x*=e,t.y*=e,t.z*=e,t}divide(e){const t=new l(this.x,this.y,this.z);return t.x/=e,t.y/=e,t.z/=e,t}}class f{constructor(e){w(this,"vertices");this.vertices=e}add(e){return new f(this.vertices.map(t=>t.add(e)))}subtract(e){return new f(this.vertices.map(t=>t.subtract(e)))}}class r{constructor(e,t,n){w(this,"x",0);w(this,"y",0);w(this,"z",0);this.x=e!=null?e:0,this.y=t!=null?t:0,this.z=n!=null?n:0}static getMidpoint(e,t){return new r((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}add(e){const t=new r(this.x,this.y,this.z);return t.x+=e.x,t.y+=e.y,t.z+=e.z,t}subtract(e){const t=new r(this.x,this.y,this.z);return t.x-=e.x,t.y-=e.y,t.z-=e.z,t}}class c{static rotateX(e,t){if(e instanceof f){const n=e.vertices.map(s=>c.rotateX(s,t));return new f(n)}else{const n=e.x,s=e.y*Math.cos(t)-e.z*Math.sin(t),o=e.y*Math.sin(t)+e.z*Math.cos(t);if(e instanceof r)return new r(n,s,o);if(e instanceof l)return new l(n,s,o);throw new TypeError("p is not a Point, Vector, or Polygon")}}static rotateY(e,t){if(e instanceof f){const n=e.vertices.map(s=>c.rotateY(s,t));return new f(n)}else{const n=e.x*Math.cos(t)+e.z*Math.sin(t),s=e.y,o=-e.x*Math.sin(t)+e.z*Math.cos(t);if(e instanceof r)return new r(n,s,o);if(e instanceof l)return new l(n,s,o);throw new TypeError("p is not a Point, Vector, or Polygon")}}}const q=new l(500,0,0),O=new l(0,500,0),W=new l(0,0,500),m=100,D=1e3,Z=1500,P=[new f([new r(100,100,1e3),new r(300,100,1e3),new r(300,300,1e3),new r(100,300,1e3)])];let v=0,L=0,x=window.innerWidth,z=window.innerHeight;function h(i){return i instanceof r?i.z>=0&&Math.abs(i.x)<=x+2*i.z&&Math.abs(i.y)<=z+2*i.z:i.vertices.every(e=>h(e))}const u=document.querySelector("#canvas");window.lockCursor=()=>{u.requestPointerLock()};document.addEventListener("pointerlockchange",()=>{S=document.pointerLockElement===u,S?document.querySelector("#pointerLockButton").style.display="none":document.querySelector("#pointerLockButton").style.display="block"});function N(){x=window.innerWidth,z=window.innerHeight,u.width=x,u.height=z}window.addEventListener("resize",N);N();const a=u.getContext("2d");a.lineWidth=4;a.fillStyle="white";a.fillRect(u.width,u.height,1,1);for(let i=-1e3;i<1e3;i+=200)P.push(new f([new r(i,1e3,-1e4),new r(i+50,1e3,-1e4),new r(i+50,1e3,1e4),new r(i,1e3,1e4)]));let k=!1,A=!1,Y=!1,K=!1,V=!1,X=!1,I=!1,S=!1,b=0,M=0;window.addEventListener("mousedown",()=>{I=!0});window.addEventListener("mouseup",()=>{I=!1});window.addEventListener("mousemove",i=>{!S&&!I||(b=i.movementX,M=i.movementY)});const T=new Set(["a","ArrowLeft"]),_=new Set(["d","e","ArrowRight"]),C=new Set(["w",",","ArrowUp"]),F=new Set(["s","o","ArrowDown"]);window.addEventListener("keydown",i=>{const{key:e}=i;T.has(e)?k=!0:_.has(e)?A=!0:C.has(e)?Y=!0:F.has(e)?K=!0:["shift"].includes(e)?V=!0:["space"].includes(e)&&(X=!0)});window.addEventListener("keyup",i=>{const{key:e}=i;T.has(e)?k=!1:_.has(e)?A=!1:C.has(e)?Y=!1:F.has(e)?K=!1:["shift"].includes(e)?V=!1:["space"].includes(e)&&(X=!1)});function H(){for(let[e,t]of P.entries())k&&(t=t.add(c.rotateY(q.divide(m),-v))),A&&(t=t.subtract(c.rotateY(q.divide(m),-v))),Y&&(t=t.subtract(c.rotateX(c.rotateY(W.divide(m),-v),L))),K&&(t=t.add(c.rotateX(c.rotateY(W.divide(m),-v),L))),X&&(t=t.add(O.divide(m))),V&&(t=t.subtract(O.divide(m))),P[e]=t;v+=b/D,L+=-M/Z;const i=P.map(e=>(e=c.rotateY(e,v),e=c.rotateX(e,L),e));for(const[e,t]of i.entries())if(!h(t)){const n=new f([]),s=t.vertices.length;for(const[o,d]of t.vertices.entries()){const E=t.vertices[(o+1)%s];if(h(d)&&n.vertices.push(d),h(d)!==h(E)){let y,p;for(h(d)?[y,p]=[d,E]:[y,p]=[E,d];;){const g=r.getMidpoint(y,p);if(g.equals(y)||g.equals(p))break;h(g)?y=g:p=g}const R=y;n.vertices.push(R)}}i[e]=n}for(const[e,t]of i.entries())for(const[n,s]of t.vertices.entries());a.clearRect(0,0,u.width,u.height);for(const e of i){if(e.vertices.length===0)continue;const t=e.vertices.map(n=>{const s=new r;return s.x=n.x*x/(x+2*n.z),s.y=n.y*z/(z+2*n.z),s.x+=x/2,s.y+=z/2,s});a.beginPath(),a.moveTo(t[0].x,t[0].y);for(const n of t.slice(1))a.lineTo(n.x,n.y);a.closePath(),a.fillStyle="black",a.fill()}b=0,M=0,requestAnimationFrame(H)}H();
